<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ title or site.title }}</title>
  <link rel="stylesheet" href="/assets/styles.css">
</head>
<body>
  <header><h1><a href="/">{{ site.title }}</a></h1></header>
  <main>
    {{ content | safe }}
  </main>
  <footer>© {{ year }} - {{ site.title }}</footer>
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <script>
  // Manejar invitaciones por hash fragment
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (!user) {
        // Revisar si hay un invite_token en la URL
        const hash = window.location.hash;
        if (hash.includes('invite_token=')) {
          // Extraer el token
          const token = hash.split('invite_token=')[1].split('&')[0];
          
          // Abrir el widget de Identity para que el usuario complete el registro
          window.netlifyIdentity.open();
          
          // Limpiar la URL
          history.replaceState(null, null, window.location.pathname);
        }
      }
    });

    // Cuando el usuario completa el login/registro
    window.netlifyIdentity.on("login", user => {
      console.log("Usuario logueado:", user.email);
    });

    // Cerrar el modal después del login
    window.netlifyIdentity.on("close", () => {
      // Opcional: redirigir al admin si se logearon
      if (window.netlifyIdentity.currentUser()) {
        console.log("Usuario disponible:", window.netlifyIdentity.currentUser().email);
      }
    });
  }
  </script>
</body>
</html>

